<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mari Belajar C</title>
    <link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-tomorrow.css" rel="stylesheet" />
</head>

<body>
    <h1>Source Code Matkul Algo</h1>

    <div id="container">
        <div id="navigation" class="navigation"></div>
        <div id="panel" class="panel">
            <p style="opacity:0.7;">Pilih salah satu file untuk menampilkan codenya</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-c.js"></script>

    <script>
        const panel = document.getElementById('panel');
        const navigation = document.getElementById('navigation');

        function loadFile(src) {
            panel.innerHTML = '';

            fetch(src)
                .then(res => {
                    if (!res.ok) throw new Error('Gagal fetch file');
                    return res.text();
                })
                .then(code => {
                    const block = document.createElement('div');
                    block.className = 'code-block';

                    const title = document.createElement('h3');
                    title.textContent = src;
                    block.appendChild(title);

                    const pre = document.createElement('pre');
                    const codeElement = document.createElement('code');
                    codeElement.className = 'language-c';
                    codeElement.textContent = code;

                    // Tombol Copy
                    const copyBtn = document.createElement('button');
                    copyBtn.textContent = 'Copy Code';
                    copyBtn.style = `
                    background: #4caf50;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    padding: 6px 10px;
                    margin-top: 10px;
                    margin-right: 10px;
                    cursor: pointer;
                    font-weight: bold;
                    `;
                    copyBtn.onclick = () => {
                        navigator.clipboard.writeText(code)
                            .then(() => {
                                copyBtn.textContent = '✅ Copied!';
                                setTimeout(() => copyBtn.textContent = 'Copy Code', 2000);
                            })
                            .catch(err => {
                                copyBtn.textContent = '❌ Failed';
                                console.error(err);
                            });
                    };
                    block.appendChild(copyBtn);

                    pre.appendChild(codeElement);
                    block.appendChild(pre);
                    panel.appendChild(block);

                    Prism.highlightElement(codeElement);
                })
                .catch(err => {
                    panel.innerHTML = `<p style="color:red;">Gagal memuat file: ${src}</p>`;
                    console.error(`Gagal load ${src}:`, err);
                });
        }

        function createNavigation(files) {
            navigation.innerHTML = '';

            // Buat map {folder: [files]}
            const grouped = {};
            files.forEach(file => {
                if (file.endsWith('.c')) {
                    const parts = file.split('/');
                    const folder = parts[1] || 'root';
                    if (!grouped[folder]) grouped[folder] = [];
                    grouped[folder].push(file);
                }
            });

            // Loop setiap folder
            Object.keys(grouped).forEach(folder => {
                const folderTitle = document.createElement('div');
                folderTitle.className = 'folder-title';
                folderTitle.textContent = `📁 ${folder}`;
                navigation.appendChild(folderTitle);

                // Tambah list file di dalam folder
                grouped[folder].forEach(file => {
                    const link = document.createElement('div');
                    link.className = 'nav-link';
                    link.textContent = '• ' + file.split('/').pop();
                    link.onclick = () => loadFile(file);
                    navigation.appendChild(link);
                });
            });
        }


        // === BAGIAN PENTING ===
        // Ambil daftar file dari index.json
        fetch('src/index.json')
            .then(res => res.json())
            .then(files => createNavigation(files))
            .catch(err => {
                navigation.innerHTML = `<p style="color:red;">Gagal memuat daftar file.</p>`;
                console.error('Gagal fetch index.json:', err);
            });

    </script>

    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #121212;
            color: #eee;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: stretch;
        }

        h1 {
            padding: 12px;
            text-align: center;
            background: #1e1e1e;
            margin: 0;
            border-bottom: 1px solid #333;
        }

        #container {
            display: flex;
            height: calc(100vh - 80px);
        }

        .navigation {
            width: 250px;
            background: #181818;
            border-right: 1px solid #333;
            overflow-y: auto;
            padding: 10px;
        }

        .nav-link {
            padding: 10px;
            margin: 5px 0;
            background: #242424;
            border-radius: 5px;
            color: #00bcd4;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-link:hover {
            background: #2f2f2f;
            transform: scale(1.02);
        }

        .panel {
            flex: 1;
            padding: 1em 2em;
            overflow-y: auto;
        }

        .code-block {
            margin-bottom: 2rem;
            position: relative;
        }

        h3 {
            margin-bottom: 0.5rem;
            color: #00bcd4;
            font-weight: 600;
            font-size: 1.2em;
        }

        pre {
            background: #1e1e1e;
            color: #ddd;
            padding: 1em;
            border-radius: 10px;
            overflow-x: auto;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #666;
        }

        .folder-title {
            margin-top: 10px;
            padding: 8px 10px;
            font-weight: bold;
            color: #ffc107;
            background: #202020;
            border-radius: 5px;
        }

        .nav-link {
            padding: 8px 15px;
            margin: 3px 0;
            background: #242424;
            border-radius: 5px;
            color: #00bcd4;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-link:hover {
            background: #2f2f2f;
            transform: scale(1.02);
        }
        
        @media screen and (max-width:767px){
            #container{
                display: flex;
                flex-direction: row;
            }
        }
    </style>

</body>

</html>